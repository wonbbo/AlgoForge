# ë‹¤ì¤‘ ì¶œë ¥ ì§€í‘œ í‘œì‹œëª… ìˆ˜ì •

## ğŸ“ ë¬¸ì œ

ì „ëµ ë¹Œë”ì˜ ì§„ì… ì¡°ê±´(Step 2)ì—ì„œ ì»¤ìŠ¤í…€ ì§€í‘œê°€ ë‹¤ì¤‘ ì¶œë ¥(2ê°œ ì´ìƒ)ì¼ ë•Œ, main í•„ë“œê°€ ì˜ëª» í‘œì‹œë˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

### ì¦ìƒ

**ì»¤ìŠ¤í…€ ì§€í‘œ** (`custom_volume`, output_fields: `["main", "vol_pos"]`)ë¥¼ ì¶”ê°€í–ˆì„ ë•Œ:

```
âŒ ì˜ëª»ëœ í‘œì‹œ:
  - custom_volume_1.custom_volume  â† main í•„ë“œ (ì§€í‘œíƒ€ì…ëª…)
  - custom_volume_1.vol_pos        â† vol_pos í•„ë“œ (í•„ë“œëª…)
```

**ë¬¸ì œì **:
- mainì€ ì§€í‘œíƒ€ì…ëª…ìœ¼ë¡œ í‘œì‹œ (`custom_volume`)
- ì¶”ê°€ í•„ë“œëŠ” í•„ë“œëª…ìœ¼ë¡œ í‘œì‹œ (`vol_pos`)
- **ì¼ê´€ì„± ì—†ìŒ!** ë‹¤ì¤‘ ì¶œë ¥ì¸ë° í‘œì‹œ ë°©ì‹ì´ ë‹¤ë¦„

---

## ğŸ¯ ì›ì¸

### ê¸°ì¡´ ë¡œì§ (ë¬¸ì œ)

```typescript
// í‘œì‹œëª… ìƒì„±
let displayLabel: string;
if (field === 'main') {
  // âŒ ëª¨ë“  main í•„ë“œë¥¼ ì§€í‘œ íƒ€ì…ëª…ìœ¼ë¡œ í‘œì‹œ
  displayLabel = `${ind.id}.${ind.type}`;
} else {
  // ë‚˜ë¨¸ì§€ëŠ” í•„ë“œëª… ì‚¬ìš©
  displayLabel = `${ind.id}.${field}`;
}
```

**ë¬¸ì œ**:
- ë‚´ì¥ ì§€í‘œëŠ” ë‹¨ì¼ ì¶œë ¥(mainë§Œ)ì´ë¯€ë¡œ ì§€í‘œíƒ€ì…ëª… ì‚¬ìš©ì´ ì ì ˆ
- ì»¤ìŠ¤í…€ ì§€í‘œê°€ ë‹¤ì¤‘ ì¶œë ¥ì¼ ë•Œë„ mainì„ ì§€í‘œíƒ€ì…ëª…ìœ¼ë¡œ í‘œì‹œ
- ê²°ê³¼: ê°™ì€ ì§€í‘œ ë‚´ì—ì„œ í‘œì‹œ ë°©ì‹ì´ ë¶ˆì¼ì¹˜

---

## âœ… í•´ê²° ë°©ë²•

### ìˆ˜ì •ëœ ë¡œì§

```typescript
// í‘œì‹œëª… ìƒì„±
let displayLabel: string;
if (outputFields.length === 1 && field === 'main') {
  // âœ… ë‹¨ì¼ ì¶œë ¥ (ë‚´ì¥ ì§€í‘œ): ì§€í‘œ íƒ€ì…ëª… ì‚¬ìš©
  displayLabel = `${ind.id}.${ind.type}`;
} else {
  // âœ… ë‹¤ì¤‘ ì¶œë ¥ ë˜ëŠ” ì¶”ê°€ í•„ë“œ: í•„ë“œëª… ì‚¬ìš© (mainë„ í•„ë“œëª…ìœ¼ë¡œ í‘œì‹œ)
  displayLabel = `${ind.id}.${field}`;
}
```

**í•µì‹¬ ë³€ê²½**:
- `outputFields.length === 1` ì¡°ê±´ ì¶”ê°€
- ë‹¨ì¼ ì¶œë ¥ì¼ ë•Œë§Œ ì§€í‘œíƒ€ì…ëª… ì‚¬ìš©
- ë‹¤ì¤‘ ì¶œë ¥ì¼ ë•ŒëŠ” ëª¨ë“  í•„ë“œë¥¼ í•„ë“œëª…ìœ¼ë¡œ í‘œì‹œ

---

## ğŸ“Š ë¹„êµ

### Before (ì´ì „) âŒ

#### ë‚´ì¥ ì§€í‘œ (EMA, ë‹¨ì¼ ì¶œë ¥)
```
âœ… ema_1.ema  (OK: ì§€í‘œíƒ€ì…ëª…)
```

#### ì»¤ìŠ¤í…€ ì§€í‘œ (ë‹¨ì¼ ì¶œë ¥)
```
âœ… my_indicator_1.my_indicator  (OK: ì§€í‘œíƒ€ì…ëª…)
```

#### ì»¤ìŠ¤í…€ ì§€í‘œ (ë‹¤ì¤‘ ì¶œë ¥)
```
âŒ custom_volume_1.custom_volume  (main: ì§€í‘œíƒ€ì…ëª…)
âœ… custom_volume_1.vol_pos        (vol_pos: í•„ë“œëª…)

ë¬¸ì œ: í‘œì‹œ ë°©ì‹ì´ ë¶ˆì¼ì¹˜!
```

---

### After (í˜„ì¬) âœ…

#### ë‚´ì¥ ì§€í‘œ (EMA, ë‹¨ì¼ ì¶œë ¥)
```
âœ… ema_1.ema  (ì§€í‘œíƒ€ì…ëª…)
```

#### ì»¤ìŠ¤í…€ ì§€í‘œ (ë‹¨ì¼ ì¶œë ¥)
```
âœ… my_indicator_1.my_indicator  (ì§€í‘œíƒ€ì…ëª…)
```

#### ì»¤ìŠ¤í…€ ì§€í‘œ (ë‹¤ì¤‘ ì¶œë ¥)
```
âœ… custom_volume_1.main      (main: í•„ë“œëª…)
âœ… custom_volume_1.vol_pos   (vol_pos: í•„ë“œëª…)

í•´ê²°: ëª¨ë“  í•„ë“œê°€ í•„ë“œëª…ìœ¼ë¡œ ì¼ê´€ë˜ê²Œ í‘œì‹œ!
```

---

## ğŸ”„ ë°ì´í„° íë¦„

### ë‹¨ì¼ ì¶œë ¥ ì§€í‘œ

```
ì§€í‘œ ì •ë³´:
  - type: "ema"
  - output_fields: ["main"]
    â†“
ë¡œì§ íŒë‹¨:
  - outputFields.length === 1 âœ…
  - field === 'main' âœ…
    â†“
í‘œì‹œëª… ìƒì„±:
  - displayLabel = `${ind.id}.${ind.type}` â†’ "ema_1.ema"
    â†“
ì €ì¥ê°’:
  - storageValue = ind.id â†’ "ema_1"
    â†“
ê²°ê³¼:
  - UI: "ema_1.ema"
  - JSON: {"ref": "ema_1"}
```

---

### ë‹¤ì¤‘ ì¶œë ¥ ì§€í‘œ

```
ì§€í‘œ ì •ë³´:
  - type: "custom_volume"
  - output_fields: ["main", "vol_pos"]
    â†“
ë¡œì§ íŒë‹¨ (main í•„ë“œ):
  - outputFields.length === 2 âŒ (ë‹¨ì¼ ì¶œë ¥ ì•„ë‹˜)
    â†“
í‘œì‹œëª… ìƒì„±:
  - displayLabel = `${ind.id}.${field}` â†’ "custom_volume_1.main"
    â†“
ì €ì¥ê°’:
  - storageValue = ind.id â†’ "custom_volume_1"
    â†“
ê²°ê³¼:
  - UI: "custom_volume_1.main"
  - JSON: {"ref": "custom_volume_1"}

ë¡œì§ íŒë‹¨ (vol_pos í•„ë“œ):
  - outputFields.length === 2 âŒ
  - field !== 'main' âœ…
    â†“
í‘œì‹œëª… ìƒì„±:
  - displayLabel = `${ind.id}.${field}` â†’ "custom_volume_1.vol_pos"
    â†“
ì €ì¥ê°’:
  - storageValue = `${ind.id}_${field}` â†’ "custom_volume_1_vol_pos"
    â†“
ê²°ê³¼:
  - UI: "custom_volume_1.vol_pos"
  - JSON: {"ref": "custom_volume_1_vol_pos"}
```

---

## ğŸ“‹ ì˜ˆì‹œ

### ì˜ˆì‹œ 1: MACD ìŠ¤íƒ€ì¼ ì§€í‘œ

**ì§€í‘œ ë“±ë¡**:
```json
{
  "name": "Custom MACD",
  "type": "custom_macd",
  "output_fields": ["main", "signal", "histogram"]
}
```

**ì „ëµ ë¹Œë”ì—ì„œ í‘œì‹œ**:
```
â”â”â” ì§€í‘œ â”â”â”
  custom_macd_1.main        â† main ë¼ì¸
  custom_macd_1.signal      â† signal ë¼ì¸
  custom_macd_1.histogram   â† histogram ë°”
```

**ì§„ì… ì¡°ê±´ ì˜ˆì‹œ**:
```
ì¢Œë³€: custom_macd_1.main
ì—°ì‚°ì: cross above
ìš°ë³€: custom_macd_1.signal
```

**ìµœì¢… JSON**:
```json
{
  "entry": {
    "long": {
      "and": [
        {
          "left": {"ref": "custom_macd_1"},
          "op": "cross_above",
          "right": {"ref": "custom_macd_1_signal"}
        }
      ]
    }
  }
}
```

---

### ì˜ˆì‹œ 2: ë³¼ë¦°ì € ë°´ë“œ ìŠ¤íƒ€ì¼

**ì§€í‘œ ë“±ë¡**:
```json
{
  "name": "Custom BB",
  "type": "custom_bb",
  "output_fields": ["main", "upper", "lower"]
}
```

**ì „ëµ ë¹Œë”ì—ì„œ í‘œì‹œ**:
```
â”â”â” ì§€í‘œ â”â”â”
  custom_bb_1.main    â† ì¤‘ê°„ì„  (SMA)
  custom_bb_1.upper   â† ìƒë‹¨ ë°´ë“œ
  custom_bb_1.lower   â† í•˜ë‹¨ ë°´ë“œ
```

**ì§„ì… ì¡°ê±´ ì˜ˆì‹œ**:
```
ì¢Œë³€: close
ì—°ì‚°ì: <
ìš°ë³€: custom_bb_1.lower
```

---

### ì˜ˆì‹œ 3: ë‹¨ì¼ ì¶œë ¥ ì»¤ìŠ¤í…€ ì§€í‘œ

**ì§€í‘œ ë“±ë¡**:
```json
{
  "name": "My Simple EMA",
  "type": "my_ema",
  "output_fields": ["main"]
}
```

**ì „ëµ ë¹Œë”ì—ì„œ í‘œì‹œ**:
```
â”â”â” ì§€í‘œ â”â”â”
  my_ema_1.my_ema   â† ì§€í‘œíƒ€ì…ëª… (ë‹¨ì¼ ì¶œë ¥)
```

**ì¼ê´€ì„±**: ë‚´ì¥ ì§€í‘œì™€ ë™ì¼í•œ ë°©ì‹

---

## ğŸ¨ UI ê°œì„  íš¨ê³¼

### Before (ì´ì „)

```
â”â”â” ì§€í‘œ â”â”â”
  ema_1.ema
  custom_volume_1.custom_volume   â† í˜¼ë€ìŠ¤ëŸ¬ì›€ (ì§€í‘œíƒ€ì…ëª…)
  custom_volume_1.vol_pos         â† í•„ë“œëª…
```

**ì‚¬ìš©ì í˜¼ë€**:
- "custom_volumeì€ ë­ì§€? ê·¸ëƒ¥ mainì´ ì•„ë‹ˆë¼?"
- "ì™œ ë‘ ê°œê°€ ë‹¤ë¥´ê²Œ í‘œì‹œë˜ì§€?"

---

### After (í˜„ì¬)

```
â”â”â” ì§€í‘œ â”â”â”
  ema_1.ema
  custom_volume_1.main      â† ëª…í™•! (í•„ë“œëª…)
  custom_volume_1.vol_pos   â† ì¼ê´€ì„± (í•„ë“œëª…)
```

**ì‚¬ìš©ì ê²½í—˜ ê°œì„ **:
- âœ… í•„ë“œëª…ì´ ëª…í™•í•˜ê²Œ í‘œì‹œë¨
- âœ… ë‹¤ì¤‘ ì¶œë ¥ ì§€í‘œì˜ ëª¨ë“  í•„ë“œê°€ ì¼ê´€ëœ ë°©ì‹
- âœ… ì–´ë–¤ ê°’ì„ ì„ íƒí•˜ëŠ”ì§€ ì§ê´€ì 

---

## âœ… ê²€ì¦

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ 1: ë‚´ì¥ ì§€í‘œ

```
1. EMA ì§€í‘œ ì¶”ê°€ (ema_1)
2. Step 2ì—ì„œ ì§„ì… ì¡°ê±´ ì¶”ê°€
3. ì¢Œë³€ ë“œë¡­ë‹¤ìš´ í™•ì¸

âœ… í‘œì‹œ: ema_1.ema (ì§€í‘œíƒ€ì…ëª…)
âœ… ì €ì¥: {"ref": "ema_1"}
```

---

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ 2: ë‹¨ì¼ ì¶œë ¥ ì»¤ìŠ¤í…€ ì§€í‘œ

```
1. ì»¤ìŠ¤í…€ ì§€í‘œ ë“±ë¡ (my_sma, output_fields: ["main"])
2. ì „ëµ ë¹Œë”ì—ì„œ ì¶”ê°€ (my_sma_1)
3. Step 2ì—ì„œ ì§„ì… ì¡°ê±´ ì¶”ê°€
4. ì¢Œë³€ ë“œë¡­ë‹¤ìš´ í™•ì¸

âœ… í‘œì‹œ: my_sma_1.my_sma (ì§€í‘œíƒ€ì…ëª…)
âœ… ì €ì¥: {"ref": "my_sma_1"}
```

---

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ 3: ë‹¤ì¤‘ ì¶œë ¥ ì»¤ìŠ¤í…€ ì§€í‘œ

```
1. ì»¤ìŠ¤í…€ ì§€í‘œ ë“±ë¡ (custom_volume, output_fields: ["main", "vol_pos"])
2. ì „ëµ ë¹Œë”ì—ì„œ ì¶”ê°€ (custom_volume_1)
3. Step 2ì—ì„œ ì§„ì… ì¡°ê±´ ì¶”ê°€
4. ì¢Œë³€ ë“œë¡­ë‹¤ìš´ í™•ì¸

âœ… í‘œì‹œ: 
  - custom_volume_1.main (í•„ë“œëª…)
  - custom_volume_1.vol_pos (í•„ë“œëª…)

âœ… ì €ì¥:
  - {"ref": "custom_volume_1"} (main)
  - {"ref": "custom_volume_1_vol_pos"} (vol_pos)
```

---

## ğŸ“š ìˆ˜ì • íŒŒì¼

**íŒŒì¼**: `apps/web/app/strategies/builder/components/ConditionRow.tsx`

**ìˆ˜ì • ìœ„ì¹˜**: 2ê³³
- ì¢Œë³€ ì„ íƒ ì˜µì…˜ (123-152ë²ˆ ì¤„)
- ìš°ë³€ ì„ íƒ ì˜µì…˜ (214-243ë²ˆ ì¤„)

**ë³€ê²½ ë‚´ìš©**:
```typescript
// Before
if (field === 'main') {
  displayLabel = `${ind.id}.${ind.type}`;
}

// After
if (outputFields.length === 1 && field === 'main') {
  displayLabel = `${ind.id}.${ind.type}`;
}
```

---

## ğŸ¯ ìš”ì•½

### ë¬¸ì œ
- ë‹¤ì¤‘ ì¶œë ¥ ì»¤ìŠ¤í…€ ì§€í‘œì˜ main í•„ë“œê°€ ì§€í‘œíƒ€ì…ëª…ìœ¼ë¡œ í‘œì‹œ
- ì¶”ê°€ í•„ë“œëŠ” í•„ë“œëª…ìœ¼ë¡œ í‘œì‹œë˜ì–´ ì¼ê´€ì„± ë¶€ì¡±

### í•´ê²°
- ë‹¨ì¼ ì¶œë ¥ì¼ ë•Œë§Œ ì§€í‘œíƒ€ì…ëª… ì‚¬ìš©
- ë‹¤ì¤‘ ì¶œë ¥ì¼ ë•ŒëŠ” ëª¨ë“  í•„ë“œë¥¼ í•„ë“œëª…ìœ¼ë¡œ í‘œì‹œ

### ê²°ê³¼
- âœ… ì¼ê´€ëœ í‘œì‹œ ë°©ì‹
- âœ… ëª…í™•í•œ í•„ë“œ ì‹ë³„
- âœ… í–¥ìƒëœ ì‚¬ìš©ì ê²½í—˜

---

## ğŸ‰ ì™„ë£Œ!

ì´ì œ ì»¤ìŠ¤í…€ ì§€í‘œì˜ ëª¨ë“  ì¶œë ¥ í•„ë“œê°€ ì¼ê´€ë˜ê²Œ í‘œì‹œë©ë‹ˆë‹¤:

- **ë‹¨ì¼ ì¶œë ¥**: `ì§€í‘œID.ì§€í‘œíƒ€ì…` (ì˜ˆ: `ema_1.ema`)
- **ë‹¤ì¤‘ ì¶œë ¥**: `ì§€í‘œID.í•„ë“œëª…` (ì˜ˆ: `custom_volume_1.main`, `custom_volume_1.vol_pos`)

**í…ŒìŠ¤íŠ¸**: ë‹¤ì¤‘ ì¶œë ¥ ì»¤ìŠ¤í…€ ì§€í‘œë¥¼ ì¶”ê°€í•˜ê³  ì „ëµ ë¹Œë”ì—ì„œ í™•ì¸í•˜ì„¸ìš”!

---

**ì‘ì„± ì¼ì**: 2025-12-13  
**ìˆ˜ì • íŒŒì¼**: 1ê°œ  
**ìˆ˜ì • ì¤„ ìˆ˜**: 4ì¤„ (2ê³³)  
**ìƒíƒœ**: ì™„ë£Œ âœ…

